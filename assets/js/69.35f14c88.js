(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{392:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"gtest-day-3-测试夹具-testfixture-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gtest-day-3-测试夹具-testfixture-的使用"}},[t._v("#")]),t._v(" GTest Day 3 —— 测试夹具（TestFixture）的使用")]),t._v(" "),s("blockquote",[s("p",[t._v("如果您发现自己编写了两个或多个对相似数据进行操作的测试，您可以使用"),s("em",[t._v("测试夹具")]),t._v("。这允许您为多个不同的测试重用相同的对象配置。")])]),t._v(" "),s("p",[t._v("创建测试夹具：")]),t._v(" "),s("ol",[s("li",[t._v("创建一个继承"),s("code",[t._v("::testing::Test")]),t._v("的类。")]),t._v(" "),s("li",[t._v("在类中声明你想复用的对象和数据。")]),t._v(" "),s("li",[t._v("定义构造和析构函数，并以protected访问权限，声明一个编写一个"),s("code",[t._v("void SetUp() override")]),t._v("和"),s("code",[t._v("void TearDown() override")]),t._v("函数。")]),t._v(" "),s("li",[t._v("如果有需要可以定义一些公共的函数，只要你想要。")])]),t._v(" "),s("p",[t._v("示例：")]),t._v(" "),s("div",{staticClass:"language-cpp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoFixtrue")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token base-clause"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" testing"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DemoFixtrue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DemoFixtrue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DoSomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetUp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TearDown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[s("code",[t._v("SetUp()")]),t._v("和"),s("code",[t._v("TearDown()")]),t._v("函数的作用，后面会说明。")]),t._v(" "),s("p",[t._v("使用测试夹具，需要使用"),s("code",[t._v("TEST_F")]),t._v("\t而不是"),s("code",[t._v("TEST")]),t._v("。在"),s("code",[t._v("TEST_F")]),t._v("中可以访问测试夹具中的对象和函数。")]),t._v(" "),s("div",{staticClass:"language-cpp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TEST_F")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TestFixtureName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" test body "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[s("code",[t._v("TestFixtureName")]),t._v("就是我们创建的测试夹具类的名称。所以"),s("strong",[t._v("使用"),s("code",[t._v("TEST_F")]),t._v("之前需要定义好测试夹具")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("TestName")]),t._v("是测试用例名称。")]),t._v(" "),s("p",[t._v("对于每个测试"),s("code",[t._v("TEST_F()")]),t._v("，googletest 将在运行时创建一个"),s("strong",[t._v("新")]),t._v("的测试夹具，立即通过 初始化它"),s("code",[t._v("SetUp()")]),t._v("，运行测试，通过调用清理"),s("code",[t._v("TearDown()")]),t._v("，然后删除测试夹具。请注意，同一测试套件中的不同测试具有不同的测试夹具对象，并且 googletest 总是在创建下一个测试夹具之前删除一个测试夹具。googletest 不会"),s("strong",[t._v("为")]),t._v("多个测试重用相同的测试夹具。一项测试对夹具所做的任何更改都不会影响其他测试。")]),t._v(" "),s("div",{staticClass:"language-cpp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TEST_F")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DemoFixtrue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" test1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DoSomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TEST_F")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DemoFixtrue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" test2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DoSomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("总结一下googletest运行测试夹具的顺序：")]),t._v(" "),s("ol",[s("li",[t._v("保存所有 googletest 标志的状态。")]),t._v(" "),s("li",[t._v("为第一个测试创建一个测试夹具对象（成员初始化，构造函数调用）。")]),t._v(" "),s("li",[t._v("执行测试夹具的"),s("code",[t._v("SetUp()")]),t._v("函数进行初始化。")]),t._v(" "),s("li",[t._v("在测试夹具对象上运行测试用例。")]),t._v(" "),s("li",[t._v("执行测试夹具的"),s("code",[t._v("TearDown()")]),t._v("函数进行清理。")]),t._v(" "),s("li",[t._v("删除测试夹具对象（析构函数调用）。")]),t._v(" "),s("li",[t._v("恢复所有 googletest 标志的状态。")]),t._v(" "),s("li",[t._v("对下一个测试重复上述步骤，直到所有测试都运行。")])]),t._v(" "),s("p",[t._v("如果发生致命故障，则将跳过后续步骤。")])])}),[],!1,null,null,null);s.default=e.exports}}]);