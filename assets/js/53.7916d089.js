(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{545:function(s,a,t){"use strict";t.r(a);var n=t(22),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"shell-脚本中调用-expect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell-脚本中调用-expect"}},[s._v("#")]),s._v(" shell 脚本中调用 expect")]),s._v(" "),t("blockquote",[t("p",[s._v("expect 是 unix/linux 系统中用来进行自动化控制和测试的软件工具。该工具利用伪终端包装其子进程，允许任意程序通过终端接入进行自动化控制。")])]),s._v(" "),t("p",[s._v("首先安装"),t("code",[s._v("expect")]),s._v("，"),t("code",[s._v("sudo apt-get install expect")]),s._v("。")]),s._v(" "),t("p",[s._v("介绍"),t("code",[s._v("expect")]),s._v("命令之前，先介绍几个和"),t("code",[s._v("expect")]),s._v("有关的命令：")]),s._v(" "),t("ul",[t("li",[s._v("spawn: spawn 命令可以启动一个脚本或程序，类似 shell,ftp,telnet,ssh,scp 等等;")]),s._v(" "),t("li",[s._v("expect: 等待程序输出,并匹配这些输出的内容")]),s._v(" "),t("li",[s._v("send: 发送一个回应给程序")]),s._v(" "),t("li",[s._v("exp_continue: 继续匹配")]),s._v(" "),t("li",[s._v("set: 定义变量")]),s._v(" "),t("li",[s._v("puts: 输出变量")]),s._v(" "),t("li",[s._v("exit: 退出 expect 命令")]),s._v(" "),t("li",[s._v("interact: 运行你和程序进行交互")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置命令执行的超时时间(s)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用spawn命令启动一个ssh命令")]),s._v("\nspawn "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" user@127.0.0.1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 捕获程序输出的`paasword`字符串，如果捕获到了，则发送`paaswd\\n`字符串到终端")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" send "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paaswd'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出expect命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" eof\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("ssh 自动登录实例：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --------------------------------------------------------------------------- #")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh自动登录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Parameter1: 用户名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Parameter2: ip地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Parameter3: 密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# output: None")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# return: None")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --------------------------------------------------------------------------- #")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("autossh")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("\n    /usr/bin/expect "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n    set timeout 10\n    spawn ssh "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ip")]),s._v('\n    expect {\n        "yes/no" { send "yes'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"; exp_continue }\n        "password" { send "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$passwd")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('" }\n    }\n    interact\nEOF')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("ssh 自动登录并切换到 root 用户:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx.xxx.xxx.xxx"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("root_pwd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v("\n\n/usr/bin/expect "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nset timeout 10\nspawn ssh "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ip")]),s._v('\nexpect {\n    "yes/no" { send "yes'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"; exp_continue }\n    "password" { send "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$passwd")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('" }\n}\nexpect "login" { send "su - root'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('" }\nexpect "Password" { send "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$root_pwd")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('" }\nexpect "~#" { send "echo hello'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('" }\nexpect eof\nEOF')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);