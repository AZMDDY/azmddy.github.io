(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{412:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"搭建私有云盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建私有云盘"}},[s._v("#")]),s._v(" 搭建私有云盘")]),s._v(" "),a("p",[s._v("在自己的家庭服务器(ubuntu18.04)上使用nextcloud搭建私有云盘。")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[a("code",[s._v("nextcloud")]),s._v("官网网址："),a("a",{attrs:{href:"https://nextcloud.com/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://nextcloud.com/install/"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-:qshell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 安装nginx和php7.x\nsudo apt-get update\nsudo apt-get upgrade\nsudo apt-get install nginx\nsudo apt-get install php7.3-dev php7.3-fpm php7.3-cli php7.3-curl php7.3-gd php7.3-cgi php7.3-intl php7.3-opcache php7.3-zip php7.3-xml php7.3-mbstring php7.3-mysql php7.3-sqlite3 php-apcu php-imagick\nsudo service nginx restart\nsudo service php7.3-fpm restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("code",[s._v("nextcloud")]),s._v("下载地址: "),a("a",{attrs:{href:"https://download.nextcloud.com/server/releases/nextcloud-18.0.3.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://download.nextcloud.com/server/releases/nextcloud-18.0.3.zip"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("将"),a("code",[s._v("nextcloud")]),s._v("压缩包解压到"),a("code",[s._v("/var/www/")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download.nextcloud.com/server/releases/nextcloud-18.0.3.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" nextcloud-18.0.3.zip "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /var/www/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" www-data:www-data /var/www/nextcloud\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bk\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/nginx/sites-available/default\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用官方提供的配置,将官方的配置复制并进行相应的修改。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("官方提供方的配置："),a("a",{attrs:{href:"https://docs.nextcloud.com/server/18/admin_manual/installation/nginx.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.nextcloud.com/server/18/admin_manual/installation/nginx.html"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"配置-ssl-证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-ssl-证书"}},[s._v("#")]),s._v(" 配置 SSL 证书")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" openssl req "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x509")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nodes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-days")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-newkey")]),s._v(" rsa:2048 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-keyout")]),s._v(" /etc/ssl/private/your-selfsigned.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" /etc/ssl/certs/your-selfsigned.crt\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方配置中默认将http重定向到https，所以需要自签名SSL证书")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx restart\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试 ip 192.168.33.123/nextcloud")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"配置-mysql-数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-mysql-数据库"}},[s._v("#")]),s._v(" 配置 mysql 数据库")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mysql-server\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" mysql\ncreate database nextcloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql8.0.4 密码认证方式发生了变化")]),s._v("\ncreate user "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nc_admin'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" identified with mysql_native_password by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果执行失败，则需要修改mysql配置文件/etc/mysql/mysql.conf.d/mysqlq.cnf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\ngrant all on nextcloud.* to "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_name'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your_ip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\nmysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" user_name "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\ncreate datebase nextcloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("然后浏览器访问"),a("code",[s._v("ip/nextcloud/index.php")]),s._v("，配置用户名和密码已经数据库。")]),s._v(" "),a("h2",{attrs:{id:"消除告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消除告警"}},[s._v("#")]),s._v(" 消除告警")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/nextcloud\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" www-data ./occ db:add-missing-indices\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" www-data ./occ db:convert-filecache-bigint\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于缓存的告警参考官方文档：https://docs.nextcloud.com/server/13/admin_manual/configuration_server/caching_configuration.html")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"使用外部存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用外部存储"}},[s._v("#")]),s._v(" 使用外部存储")]),s._v(" "),a("p",[s._v("启动"),a("code",[s._v("External storage support")]),s._v("应用。")]),s._v(" "),a("p",[s._v("挂载外部存储。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AZMDDY/imgs/image-20200412132242103.png",alt:"image-20200412132242103"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);