# 浅谈代码性能优化

> 程序的性能受很多复杂因素影响，谈及性能必须强调“这是在我的环境上的测试结果”。代码的性能优化并没有很多普适性的规范，与其在初始化列表、函数参数使用引用而非传值、前置++等等这些上花费精力，不如从软件架构、业务流程、关键算法这些方面进行优化，这些才能切实的实现性能的提升。



谈及性能优化，如果不强调是“**A硬件，B操作系统，C版本的D编译器，编译参数是E，通过F方式运行，……**”就是在耍流氓，性能优化措施都只会在特定环境下有效，不能生搬硬套。对于实际开发过程中，性能问题一般都是测试在做性能测试的时候提出的，此时除了要知道上述条件外，还需要知道“**测试方法，上个版本的测试结果，……**”，如果没有这些条件，性能优化就无从谈起，没有对比哪来优化？



从实际工作来看，大部分性能恶化都是出现在关键业务流程和关键算法上，至于软件架构优化和演进就不在开发小兵的考虑范畴。



那么对于开发小兵而言，在日常的开发编码中如何写出性能良好的代码呢？

首先做好模块设计。在模块设计阶段，考虑清楚业务场景和交互场景，把业务先做好，可靠性和稳定性做扎实，如果基本业务都有问题，那谈什么优化呢？在做模块设计时要考虑到业务平稳，不能出现性能尖峰（CPU、内存使用率忽高忽低），能不能考虑一秒内的大量业务离散到十秒内进行处理呢？在业务主流程中新增功能要谨慎，任何一点额外消耗都会放大。能在业务主流程去查数据库吗？

其次要理解性能恶化的本质。在日常开发中（我指的的纯粹开发业务代码，不涉及算法），需要知道哪些情况会有额外的消耗，比如额外的拷贝和移动操作、常见数据结构读写效率的差异等等，理解了这些你才会明白编程规范中那些**规则**和**建议**，你写出的代码才会相对较好。其实这些代码级的优化手段作用有限，但这是每个开发小兵必须掌握的。不积跬步，无以至千里。

最后想说的是，**不要过早过多的考虑代码优化**，应该以代码健壮、简洁、易读为着眼点，现代编译器已经为我们做了大量优化，在没有出现性能瓶颈前，不需要太过关注性能优化。相信我，性能瓶颈不会是在你的多一次拷贝操作上，而且`++i`一定比`i++`效率高吗？



我很赞同侯捷老师的一句话：“源码面前，了无秘密”。实践出真知，看看源码吧，看看汇编吧，看看编译器做了啥，你的疑惑都会有答案。推荐一个网站：**Compiler Explorer**: https://gcc.godbolt.org/

