---
sort: 1
---



# 预处理（预编译）

> 预处理是编译的第一个阶段，主要是处理预编译指令。



```cpp
// hello.cpp

#define MAX_LEN 10

#pragma pack(1)
struct Data {
    int len;
    char msg[0];
};
#pragma pack()


int main(int argc, char** argv)
{
    int a = MAX_LEN;
    return 0;
}
```

是将源文件和相关的头文件预编译成一个`.i`文件。

预编译命令如下：

```shell
g++ -E hello.cpp -o hello.i
```

![image-20220227153625599](https://raw.githubusercontent.com/AZMDDY/imgs/master/img/image-20220227153625599.png)

主要处理规则如下：

+ 展开所有的宏定义，并删除所有的`#define`。
+ 处理所有的条件编译指令，例如：`#if`,`#ifdef`,`elif`,`#else`,`#endif`。
+ 递归处理`#include`预编译指令，将被包含的文件内容插入到该预编译指令的位置。
+ 添加行号和文件名标识，便于编译时编译器产生调试用的行号信息。
+ 保留所有的`#pragma`编译指令，后续编译器需要使用。



如果项目中存在多个同名（内容不同）的结构体（或者其他变量），不确定当前源文件中使用的是哪个结构体，可以通过预编译查看当前源文件真正使用的结构体是哪个。